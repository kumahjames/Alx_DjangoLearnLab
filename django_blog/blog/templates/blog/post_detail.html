{% extends 'blog/base.html' %}

{% block title %}{{ post.title }} - Django Blog{% endblock %}

{% block content %}
    <div style="max-width: 800px; margin: 0 auto;">
        <h1>{{ post.title }}</h1>
        
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #eee;">
            <div>
                <small>
                    By <strong>{{ post.author.username }}</strong> on {{ post.published_date|date:"F d, Y H:i" }}
                </small>
            </div>
            
            {% if user == post.author %}
                <div>
                    <a href="{% url 'post-update' post.id %}" style="color: #17a2b8; margin-right: 15px; padding: 5px 10px; border: 1px solid #17a2b8; border-radius: 3px; text-decoration: none;">
                        Edit Post
                    </a>
                    <a href="{% url 'post-delete' post.id %}" style="color: #dc3545; padding: 5px 10px; border: 1px solid #dc3545; border-radius: 3px; text-decoration: none;">
                        Delete Post
                    </a>
                </div>
            {% endif %}
        </div>
        
        <div style="line-height: 1.6; font-size: 16px;">
            {{ post.content|linebreaks }}
        </div>
        
        <!-- Tags Section -->
        <div style="margin-top: 20px;">
            <h4>Tags:</h4>
            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                {% for tag in post.tags.all %}
                    <a href="{% url 'posts-by-tag' tag.slug %}" 
                       style="background-color: #e9ecef; color: #495057; padding: 4px 12px; border-radius: 15px; text-decoration: none; font-size: 14px;">
                        {{ tag.name }}
                    </a>
                {% empty %}
                    <p>No tags yet.</p>
                {% endfor %}
            </div>
        </div>
        
        <!-- Comments Section -->
        <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #eee;">
            <h3>Comments ({{ comments.count }})</h3>
            
            <!-- Display existing comments -->
            {% for comment in comments %}
                <div style="margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <strong>{{ comment.author.username }}</strong>
                        <small>{{ comment.created_at|date:"F d, Y H:i" }}</small>
                    </div>
                    <p style="margin: 0;">{{ comment.content|linebreaks }}</p>
                    
                    <!-- Comment actions (only for comment author) -->
                    {% if user == comment.author %}
                        <div style="margin-top: 10px;">
                            <a href="{% url 'comment-update' comment.id %}" style="color: #17a2b8; margin-right: 10px; font-size: 14px; text-decoration: none;">
                                Edit
                            </a>
                            <a href="{% url 'comment-delete' comment.id %}" style="color: #dc3545; font-size: 14px; text-decoration: none;">
                                Delete
                            </a>
                        </div>
                    {% endif %}
                </div>
            {% empty %}
                <p>No comments yet. Be the first to comment!</p>
            {% endfor %}
            
            <!-- Add comment form (only for logged in users) -->
            {% if user.is_authenticated %}
                <div style="margin-top: 30px;">
                    <h4>Add a Comment</h4>
                    <form method="post" action="{% url 'comment-create' post.id %}">
                        {% csrf_token %}
                        <div style="margin-bottom: 15px;">
                            {{ comment_form.content }}
                        </div>
                        <button type="submit" style="background-color: #007bff; color: white; padding: 8px 16px; border: none; border-radius: 3px; cursor: pointer;">
                            Post Comment
                        </button>
                    </form>
                </div>
            {% else %}
                <div style="margin-top: 20px; padding: 15px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px;">
                    <p>Please <a href="{% url 'login' %}" style="color: #007bff;">login</a> to post a comment.</p>
                </div>
            {% endif %}
        </div>
        
        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
            <a href="{% url 'post-list' %}" style="color: #007bff; text-decoration: none;">‚Üê Back to All Posts</a>
        </div>
    </div>
{% endblock %}